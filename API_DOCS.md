# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API To-Do Bot

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ API To-Do Bot.

## üì¶ –ú–æ–¥—É–ª–∏

### 1. `bot.py` - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –±–æ—Ç–∞

–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API.

#### –ö–ª–∞—Å—Å—ã –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```python
class States(Enum):
    """–°–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏"""
    WAITING_TASK_NAME = 1      # –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
    WAITING_TIMEZONE = 2       # –û–∂–∏–¥–∞–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
    WAITING_REMINDER_TIME = 3  # –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

EMOJIS = {
    "list": "üìã",
    "add": "‚ûï",
    "done": "‚úÖ",
    "pending": "‚è≥",
    "back": "‚óÄÔ∏è",
    # ... –∏ –¥—Ä—É–≥–∏–µ
}
```

#### –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| `start()` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start`. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `pending_tasks()` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á |
| `completed_tasks()` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á |
| `add_task_start()` | –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ |
| `task_name_received()` | –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ |
| `timezone_received()` | –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ |
| `reminder_time_received()` | –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è |
| `complete_todo()` | –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é |
| `delete_todo()` | –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É |
| `back_to_main()` | –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `cancel()` | –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è |

### 2. `database.py` - –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

–ö–ª–∞—Å—Å `TodoDatabase` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏.

#### –ú–µ—Ç–æ–¥—ã `TodoDatabase`

```python
class TodoDatabase:
    def __init__(self, filename: str = "todos.json")
    def add_todo(user_id: int, task: str, timezone: str, 
                 reminder_time: str) -> bool
    def get_pending_todos(user_id: int) -> List[Dict]
    def get_completed_todos(user_id: int) -> List[Dict]
    def complete_todo(user_id: int, todo_id: int) -> bool
    def delete_todo(user_id: int, todo_id: int) -> bool
    def get_user_timezone(user_id: int) -> str
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```json
{
  "user_id": {
    "timezone": "GMT+3",
    "todos": [
      {
        "id": 0,
        "task": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
        "completed": false,
        "created_at": "ISO8601 —Ñ–æ—Ä–º–∞—Ç",
        "reminder_time": "HH:MM"
      }
    ]
  }
}
```

## üîÑ –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```
–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    ‚Üì
–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (.env)
    ‚Üì
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Application
    ‚Üì
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    ‚Üì
–ó–∞–ø—É—Å–∫ polling
    ‚Üì
–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
```

### 2. –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
```
–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É"
    ‚Üì
ConversationHandler.entry_point = add_task_start()
    ‚Üì
–í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
    ‚Üì 
task_name_received() [State: WAITING_TASK_NAME]
    ‚Üì
–í–≤–æ–¥ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
    ‚Üì
timezone_received() [State: WAITING_TIMEZONE]
    ‚Üì
–í–≤–æ–¥ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    ‚Üì
reminder_time_received() [State: WAITING_REMINDER_TIME]
    ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DB
    ‚Üì
ConversationHandler.END
    ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤

```
–ù–∞–∂–∞—Ç–∞ inline-–∫–Ω–æ–ø–∫–∞
    ‚Üì
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ pattern (regex)
    ‚Üì
–í—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    ‚Üì
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ
    ‚Üì
–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

## üîê –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –í—Ä–µ–º–µ–Ω–∏
```python
try:
    datetime.strptime(reminder_time, "%H:%M")  # HH:MM —Ñ–æ—Ä–º–∞—Ç
    # –í–∞–ª–∏–¥–Ω–æ
except ValueError:
    # –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

### –ß–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
```python
if timezone_str.startswith("GMT") and ("+" in timezone_str or "-" in timezone_str):
    # –í–∞–ª–∏–¥–Ω–æ: GMT+3, GMT-5, GMT+5:30
else:
    # –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

## üì° Callback'–∏ –∏ –∏—Ö patterns

| Pattern | –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|---------|
| `pending_tasks` | `pending_tasks()` | –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| `completed_tasks` | `completed_tasks()` | –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| `add_task` | `add_task_start()` | –ù–∞—á–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `back_to_main` | `back_to_main()` | –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é |
| `complete_\d+` | `complete_todo()` | –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É (ID) |
| `delete_\d+` | `delete_todo()` | –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É (ID) |

## üéØ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "14.30"
–û—Ç–≤–µ—Ç: "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏!
–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç: –ß–ß:–ú–ú–ú"
```

### –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "London"
–û—Ç–≤–µ—Ç: "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç!
–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç: GMT+3 –∏–ª–∏ GMT-5"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

```
/start ‚Üí start()
    ‚îú‚îÄ‚îÄ /pending_tasks ‚Üí pending_tasks()
    ‚îÇ   ‚îî‚îÄ‚îÄ –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é ‚Üí complete_todo()
    ‚îÇ       ‚îî‚îÄ‚îÄ /back ‚Üí back_to_main()
    ‚îú‚îÄ‚îÄ /completed_tasks ‚Üí completed_tasks()
    ‚îÇ   ‚îî‚îÄ‚îÄ –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É ‚Üí delete_todo()
    ‚îÇ       ‚îî‚îÄ‚îÄ /back ‚Üí back_to_main()
    ‚îî‚îÄ‚îÄ /add_task ‚Üí ConversationHandler
        ‚îú‚îÄ‚îÄ WAITING_TASK_NAME ‚Üí task_name_received()
        ‚îú‚îÄ‚îÄ WAITING_TIMEZONE ‚Üí timezone_received()
        ‚îú‚îÄ‚îÄ WAITING_REMINDER_TIME ‚Üí reminder_time_received()
        ‚îî‚îÄ‚îÄ END ‚Üí back_to_main()
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```
TELEGRAM_BOT_TOKEN=your_token_here
```

### –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `todos.json`
- –§–æ—Ä–º–∞—Ç: JSON
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

## üí° –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø—Ä–∏–º–µ—Ä)
```python
db = TodoDatabase()
success = db.add_todo(
    user_id=123456789,
    task="–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ",
    timezone="GMT+3",
    reminder_time="09:00"
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
```python
todos = db.get_pending_todos(user_id=123456789)
for todo in todos:
    print(f"{todo['task']} - {todo['reminder_time']}")
```

### –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é
```python
db.complete_todo(user_id=123456789, todo_id=0)
```

## üöÄ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

–ö–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **–ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –î–æ–±–∞–≤—å –∏—Ö –≤ `States(Enum)`
2. **–ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**: –°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π `async def handler(update, context)`
3. **–ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏**: –î–æ–±–∞–≤—å `InlineKeyboardButton` –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
4. **–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã DB**: –î–æ–±–∞–≤—å –º–µ—Ç–æ–¥ –≤ –∫–ª–∞—Å—Å `TodoDatabase`

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–æ–¥—É–ª—å `logging`:

```python
logger = logging.getLogger(__name__)
logger.info("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
```

–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `INFO`

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±–æ—Ç–∞

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** (Startup)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –°–æ–∑–¥–∞–Ω–∏–µ Application
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

2. **–†–∞–±–æ—Ç–∞** (Running)
   - polling() —Å–ª—É—à–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram
   - –ö–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º handler'–æ–º

3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** (Shutdown)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ .json)
   - –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

**–î–∞—Ç–∞:** 28 –¥–µ–∫–∞–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0
